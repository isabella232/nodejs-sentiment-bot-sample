---
page_type: sample
products:
- ms-graph
languages:
- nodejs
- typescript
description: "Используйте Microsoft Graph, Microsoft Cognitive Services и Microsoft Bot Framework для анализа настроений в веб-приложении NodeJS"
extensions:
  contentType: samples
  technologies:
  - Microsoft Graph
  - Microsoft Bot Framework 
  createdDate: 9/13/2017 10:47:10 AM
---
# Microsoft Graph Анализ настроений Bot

## Содержание

* [Введение](#introduction)
* [Предварительные требования](#prerequisites)
* [Получить ключ для API текстовых аналитиков](#get-a-key-for-the-text-analytics-api) 
* [Опубликовать модель LUIS](#publish-the-luis-model)
* [Регистрация веб-приложения](#register-the-web-application)
* [выполнить сборку кода из примера;](#build-the-sample)
* [Запустите пример](#run-the-sample)
* [Вопросы и комментарии](#questions-and-comments)
* [Участие](#contributing)
* [Дополнительные ресурсы](#additional-resources)

## Введение

В этом примере показано, как создать [Microsoft Bot Framework](https://dev.botframework.com/), который подключается к [Microsoft Graph](https://developer.microsoft.com/en-us/graph/), просматривает сообщения в сообщениях электронной почты и выполняет анализ мнений в этих сообщениях с помощью [Познавательный сервис Microsoft Text Analytics](https://docs.microsoft.com/en-us/azure/cognitive-services/text-analytics/quick-start). Он использует интеллектуальную службу [Интеллектуальная служба Понимания языка ](https://www.luis.ai), чтобы помочь вашему боту понять запросы, которые вы ему отправляете.

## Предварительные требования

Чтобы использовать образец Microsoft Graph Connect для Node.js, вам необходимо следующее:

 * [Node.js](https://nodejs.org/)
 * [TypeScript](http://www.typescriptlang.org/)
 * [Bot Framework Emulator](https://docs.microsoft.com/en-us/bot-framework/debug-bots-emulator)
 * [Учетная запись Microsoft](https://www.outlook.com/) или [рабочая или учебная учетная запись](http://dev.office.com/devprogram)
 * Учетная запись [Microsoft Azure](https://azure.microsoft.com/en-us/free/)
 * [учетная запись Интеллектуальной службы Понимания языка](https://www.luis.ai/)

В дополнение к этим предварительным условиям вам необходимо [получить ключ подписки для API Text Analytics](#get-a-key-for-the-text-analytics-api)), [опубликовать модель LUIS]() и [зарегистрировать приложение веб-клиента](#register-the-web-application). В следующих трех разделах описано, как получить эти дополнительные ресурсы.

## Получить ключ для API текстовых аналитиков

1. Войдите на [портал Azure](https://portal.azure.com).

2. В нижней части левого столбца страницы выберите **другие службы**.

3. В поле **Фильтр** в верхней части столбца **Дополнительные службы** введите **Cognitive Services**.

4. Выберите опцию **Cognitive Services**, когда она появится.

5. Нажмите кнопку **Добавить** в верхней части страницы.

6. Выберите опцию **Text Analytics API (предварительный просмотр)** на правой панели.

7. Нажмите кнопку **Создать** в нижней части правой панели.

8. Введите имя для вашей подписки и выберите план. Вы можете выбрать бесплатный уровень для 5000 транзакций в месяц.

9. Прочитайте и подтвердите, что вы поняли уведомление в нижней части панели, а затем нажмите кнопку **Создать** в самом низу.

10. После создания подписки перейдите к своей подписке и выберите **Ключи** в разделе **Управление ресурсами** на центральной панели.

11. Скопируйте значение первого ключа («Ключ 1»). Вы будете использовать это значение в разделе [Построить образец](#build-the-sample)


## Опубликовать модель LUIS

1. Перейдите на домашнюю страницу [Интеллектуальная служба понимания языка](https://www.luis.ai) (LUIS).

2. Создайте учетную запись LUIS, если у вас ее еще нет. Вы автоматически перейдете на панель управления учетной записью.

3. Выберите **Мои приложения** в верхнем левом углу страницы панели инструментов.

4. Выберите **приложение для импорта**.

5. В всплывающем окне найдите файл [SearchBotLUIS.json](./SearchBotLUIS.json) в корневом каталоге этого репозитория.

6. Нажмите кнопку "**импорт**". Вы автоматически перейдете на страницу информационной панели своего нового приложения.

7. В меню слева выберите **опубликовать приложение**.

8. Выберите значение **BootstrapKey** по умолчанию в качестве значения для **клавишу конечной точки**, а затем нажмите кнопку **публиковать**.
![Скриншот Microsoft Graph Sentiment Bot](./readme-images/PublishLUISApp.png)

9. Скопируйте **URL-адрес конечной точки**. Вы будете использовать это значение в разделе [Построить образец](#build-the-sample)

10. Чтобы перейти на страницу, на которой можно выполнить тестовый запрос в соответствии с опубликованной моделью, выберите в меню слева пункт **обучить и тестировать**. Введите **Поиск Office 365 для Graph** на панели тестовых высказываний, чтобы убедиться, что ваше новое приложение находит цель для этого запроса.

## Зарегистрировать веб-приложение

1. Войдите на [портал регистрации приложений Azure](https://go.microsoft.com/fwlink/?linkid=2083908) с помощью личной, рабочей или учебной учетной записи.

2. Выберите **Новая регистрация**.

3. Введите имя для приложения. Для **Поддерживаемых типов учетных записей** выберите **Учетные записи в любом организационном каталоге и личные учетные записи Microsoft (например, Skype, Xbox, Outlook.com)**.

4. Введите *https://localhost:3980/botauth/aadv2/callback* в качестве URI перенаправления (веб-сайта).

5. Нажмите кнопку **Зарегистрировать**.
	
   Откроется страница обзора приложения со списком свойств вашего приложения.

6. Скопируйте идентификатор приложения (клиента) со страницы обзора. Это уникальный идентификатор приложения.

7. Выберите **Сертификаты и секреты** в разделе **Управление**. Выберите **новый секрет клиента**, введите его описание и дату окончания срока действия, а затем нажмите кнопку **добавить**.

8. Скопируйте и сохраните новый секретный ключ клиента. Это единственный раз, когда вы сможете увидеть секрет клиента.

   Вы будете использовать идентификатор приложения и секрет клиента для настройки примера приложения в следующем разделе.

## выполнить сборку кода из примера;

1. Загрузите или клонируйте этот репозиторий.

2. В вашей любимой среде IDE откройте файл **. env** в корневом каталоге репозитория.

3. Замените значение заполнителя **ENTER\_YOUR\_COG\_SERVICE\_SUBSCRIPTION\_KEY** на ключ API Text Analytics, скопированный в [получить ключ для раздела API Text Analytics](#get-a-key-for-the-text-analytics-api).

4. Замените значение заполнителя **ENTER\_YOUR\_LUIS\_MODEL\_URL** на URL-адрес конечной точки, который вы скопировали в разделе [Публикация модели LUIS](#publish-the-luis-model).

5. Замените значения заполнителей **ENTER\_YOUR\_CLIENT\_ID** и **ENTER\_YOUR\_CLIENT\_SECRET** на идентификатор приложения и секретный ключ приложения, которые вы скопировали в разделе [Регистрация веб-приложения](#register-the-web-application).

6. В командной строке выполните следующую команду в корневом каталоге. При этом устанавливаются зависимости проекта.

  ```npm install```

7. Выполните следующую команду, чтобы запустить сервер разработки.

  ```npm start```

8. Запустите [эмулятор Bot Framework](https://docs.microsoft.com/en-us/bot-framework/debug-bots-emulator).

9. Укажите конечную точку обмена сообщениями для этого проекта. https://localhost:3980/api/messages. Оставьте значения Microsoft App ID и Microsoft App Password пустыми. Это для опубликованных ботов.

10. Нажмите кнопку **подключиться**. 

## Запустите пример

1. Введите запрос в эмулятор Bot Framework в этой форме: **Поиск Office 365 для графа**.

2. Вы увидите кнопку **подключения** в эмуляторе. Нажмите эту кнопку, чтобы запустить веб-страницу, отображающую строку в браузере. Вам будет предлагаться ввести эту строку в чат. Обратите внимание, что ваш браузер может предупредить вас, что ваш компьютер не доверяет сертификату безопасности сайта. Выберите опцию, чтобы перейти на веб-страницу.

3. После того, как вы введете строку в свой чат, вы получите сообщение с указанием оценки настроения для вашего запроса.
![Скриншот Microsoft Graph Sentiment Bot](./readme-images/BotPreview.png)

4. Введите дополнительные запросы, чтобы увидеть анализ настроений когнитивных услуг на работе.

## Вопросы и комментарии

Мы хотели бы получить ваши отзывы о образце Microsoft Graph Connect для Node.js. Вы можете отправлять нам свои вопросы и предложения с помощью вкладки [Проблемы](https://github.com/microsoftgraph/nodejs-sentiment-bot-sample/issues) этого репозитория.

Общие вопросы о разработке решений для Microsoft Graph следует задавать на сайте [Stack Overflow](https://stackoverflow.com/questions/tagged/microsoftgraph). Обязательно помечайте свои вопросы и комментарии тегом \[microsoftgraph].

## Участие ##

Если вы хотите добавить код в этот пример, просмотрите статью [CONTRIBUTING.MD](/CONTRIBUTING.md).

Этот проект соответствует [Правилам поведения разработчиков открытого кода Майкрософт](https://opensource.microsoft.com/codeofconduct/). Дополнительные сведения см. в разделе [вопросов и ответов о правилах поведения](https://opensource.microsoft.com/codeofconduct/faq/). Если у вас возникли вопросы или замечания, напишите нам по адресу [opencode@microsoft.com](mailto:opencode@microsoft.com).
  
## Дополнительные ресурсы

- [Другие примеры кода для Microsoft Graph](https://github.com/microsoftgraph?utf8=%E2%9C%93&q=sample)
- [Microsoft Graph](https://graph.microsoft.io)

## Авторские права
(c) Корпорация Майкрософт (Microsoft Corporation), 2017. Все права защищены.
